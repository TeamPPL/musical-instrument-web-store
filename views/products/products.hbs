<link href="vendors/jquery-ui/jquery-ui.css" rel="stylesheet">
<!--================Categories Banner Area =================-->
<section class="categories_banner_area">
    <div class="container">
        <div class="c_banner_inner">
            <h3>Products</h3>
        </div>
    </div>
</section>
<!--================End Categories Banner Area =================-->

<!--================Categories Product Area =================-->
<section class="categories_product_main p_80">
    <div class="container">
        <div class="categories_main_inner">
            <div class="row row_disable">
                <div class="col-lg-9 float-md-right">
                    <div class="search-container">
                        <input id="search-box" type="text" placeholder="Search.." name="searchText">
                        <button id="search-button" type="submit"><i class="fa fa-search"></i></button>
                    </div>
                    <div class="showing_fillter">
                        <div class="row m0">
                            <div class="first_fillter">
                                <h4>Showing {{pageInfo.firstItemOfPage}} to {{pageInfo.lastItemOfPage}} of {{pageInfo.totalCount}} total</h4>
                            </div>
                            <div class="secand_fillter">
                                <h4>SORT BY :</h4>
                                <select id="sorted" name="sorted" class="selectpicker">
                                    <option value="alphabet-asc">Name (A-Z)</option>
                                    <option value="alphabet-desc">Name (Z-A)</option>
                                    <option value="lastest">Lastest</option>
                                    <option value="oldest">Oldest</option>
                                </select>
                            </div>
                            <div class="third_fillter">
                                <h4>Show : </h4>
                                <select id="n-per-page" name="n-per-page" class="selectpicker">
                                    <option value="9">09</option>
                                    <option value="15">15</option>
                                    <option value="24">24</option>
                                </select>
                            </div>
                            <!--
                            <div class="four_fillter">
                                <h4>View</h4>
                                <a class="active" href="#"><i class="icon_grid-2x2"></i></a>
                                <a href="#"><i class="icon_grid-3x3"></i></a>
                            </div>
                            -->
                        </div>
                    </div>
                    <!--================Products & Paging Area =================-->
                    <div id="product-items-partial-displayer" >
                        {{>productItems}}
                    </div>
                    <!--================End Products & Paging Area =================-->
                </div>
                <div class="col-lg-3 float-md-right">
                    <div class="categories_sidebar">
                        <aside class="l_widgest l_p_categories_widget">
                            <div class="l_w_title">
                                <h3>Categories</h3>
                            </div>
                            <ul class="navbar-nav">
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Guitar
                                    <i class="icon_plus" aria-hidden="true"></i>
                                    <i class="icon_minus-06" aria-hidden="true"></i>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <li class="nav-item"><a class="nav-link" href="#">Classic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Ascoutic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Electric</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Violin
                                    <i class="icon_plus" aria-hidden="true"></i>
                                    <i class="icon_minus-06" aria-hidden="true"></i>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <li class="nav-item"><a class="nav-link" href="#">Classic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Ascoutic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Electric</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Piano
                                    <i class="icon_plus" aria-hidden="true"></i>
                                    <i class="icon_minus-06" aria-hidden="true"></i>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <li class="nav-item"><a class="nav-link" href="#">Classic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Ascoutic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Electric</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Drum
                                    <i class="icon_plus" aria-hidden="true"></i>
                                    <i class="icon_minus-06" aria-hidden="true"></i>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <li class="nav-item"><a class="nav-link" href="#">Classic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Ascoutic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Electric</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Other
                                    <i class="icon_plus" aria-hidden="true"></i>
                                    <i class="icon_minus-06" aria-hidden="true"></i>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                        <li class="nav-item"><a class="nav-link" href="#">Classic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Ascoutic</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#">Electric</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </aside>
                        <aside class="l_widgest l_fillter_widget">
                            <div class="l_w_title">
                                <h3>Filter section</h3>
                            </div>
                            <div id="slider-range" class="ui_slider"></div>
                            <label for="amount">Price:</label>
                            <input type="text" id="amount" readonly>
                        </aside>
                        <aside class="l_widgest l_color_widget">
                            <div class="l_w_title">
                                <h3>Color</h3>
                            </div>
                            <ul>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                                <li><a href="#"></a></li>
                            </ul>
                        </aside>
                        <aside class="l_widgest l_menufacture_widget">
                            <div class="l_w_title">
                                <h3>Manufacturer</h3>
                            </div>
                            <ul>
                                <li><a href="#">Gibson</a></li>
                                <li><a href="#">Steinway</a></li>
                                <li><a href="#">Sennheiser</a></li>
                                <li><a href="#">Yamaha</a></li>
                                <li><a href="#">Roland</a></li>
                            </ul>
                        </aside>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="/js/jquery-3.2.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
<script>
    $(document).ready(function(){
        
        Handlebars.registerHelper("log", function(something) {
        console.log(something);
        });

        $('.selectpicker').change(triggerAjaxFilter);
        $("#search-button").click(triggerAjaxFilter)
        $('#search-box').bind("enterKey",triggerAjaxFilter);
        $('#search-box').keyup(function(e){
            if(e.keyCode == 13)
            {
                $(this).trigger("enterKey");
            }
        });

        $('#product-items-partial-displayer').on("click", '.pagination_area .pagination li a', (e) => {
            e.preventDefault();
            let classList = $(e.target).attr("class");
            let classArr = classList.split(" ");
            let pageNumber;
            let isNextOrPrevBtn = false;
            console.log(e.target);
            console.log(classArr);
            classArr.forEach(element => {
                if (element === "fa-angle-right" || element === "next") {
                    pageNumber = parseInt($('.pagination_area .pagination a.current').html()) + 1;
                    isNextOrPrevBtn = true;
                } else if (element === "fa-angle-left" || element === "prev") {
                    pageNumber = parseInt($('.pagination_area .pagination a.current').html()) - 1;
                    isNextOrPrevBtn = true;
                }
            })

            if (!isNextOrPrevBtn) {
                pageNumber = parseInt($(e.target).html());
            }
            console.log(pageNumber);
            let data = {
                search: $('#search-box').val(),
                sorted: $('#sorted').children("option:selected").val(),
                nPerPage: $('#n-per-page').children("option:selected").val(),
                pageNumber
            }
            sendRequest(data);
        });

        function triggerAjaxFilter() {
            let data = {
                search: $('#search-box').val(),
                sorted: $('#sorted').children("option:selected").val(),
                nPerPage: $('#n-per-page').children("option:selected").val(),
                pageNumber: 1
            }
            console.log(data);
            sendRequest(data);
            return;
        }
        
        function sendRequest(data) {
            $.post('/products', data, (result, status) => {
                //alert("Data: " + data + "\nStatus: " + status);
                //console.log(data);
                //Handlebars.registerPartial('productItems', '{{productItems}}');
                //productItems = data.productItems;

                //let productItemsPartial = Handlebars.partials[productItems];
                //console.log(productItemsPartial);
                //$('#product-items-partial-displayer').html(productItemsPartial(result));
                console.log(status);
                let source   = result.partials;
                
                console.log(source);
                let template = Handlebars.compile(source);
                //console.log(template);
                let htmlCompiled = template(result);
                //let htmlCompiled = Handlebars.template(template);
                //console.log(htmlCompiled);
                // you will now have some html that you will need to insert into your page
                document.getElementById("product-items-partial-displayer").innerHTML = htmlCompiled;
                
            });
            return;
        }
    });

    //});
    /*
    function submitForm() {
        form = document.getElementById('fillter-form');
        console.log(form);
        form.submit();
    }
    */
</script>
<!--================End Categories Product Area =================-->

<!--
    
            <form method="GET" action="/products" id="fillter-form">
                    <script id="product-items-partial" type="text/x-handlebars-template">
                    </script>
                    
                    <div id="product-items-partial-displayer" >
                    </div>
                    -->