<!--================Categories Banner Area =================-->
<section class="categories_banner_area">
    <div class="container">
        <div class="c_banner_inner">
            <h3>PRODUCT DETAILS</h3>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/products">Shop</a></li>
                <li><a href="/products">{{productItems.filter}}</a></li>
                <li class="current"><a href="/products">{{productItems.title}}</a></li>
            </ul>
        </div>
    </div>
</section>
<!--================End Categories Banner Area =================-->

<!--================Product Details Area =================-->
<section class="product_details_area">
    <div class="container">
        <div class="row">
            <div class="col-lg-5">
                <div class="product_details_slider">
                    <div id="product_slider2" class="rev_slider" data-version="5.3.1.6">
                        <ul>
                            <!-- SLIDE  -->
                            <li data-index="rs-28" data-transition="scaledownfromleft" data-slotamount="default"
                                data-easein="default" data-easeout="default" data-masterspeed="1500"
                                data-thumb="{{productItems.cover}}" data-rotate="0" data-fstransition="fade"
                                data-fsmasterspeed="1500" data-fsslotamount="7" data-saveperformance="off"
                                data-title="Umbrella" data-param1="September 7, 2015"
                                data-param2="Alfon Much, The Precious Stones" data-description="">
                                <!-- MAIN IMAGE -->
                                <img src="{{productItems.cover}}" alt="" width="1920" height="1080"
                                    data-lazyload="{{productItems.cover}}" data-bgposition="center center"
                                    data-bgfit="contain" data-bgrepeat="no-repeat" class="rev-slidebg" data-no-retina>
                                <!-- LAYERS -->
                            </li>
                            <li data-index="rs-303" data-transition="scaledownfromleft" data-slotamount="default"
                                data-easein="default" data-easeout="default" data-masterspeed="1500"
                                data-thumb="{{productItems.cover2}}" data-rotate="0" data-saveperformance="off"
                                data-title="The Dreaming Girl" data-param1="September 6, 2015" data-param2="Lol"
                                data-description="">
                                <img src="{{productItems.cover2}}" alt="" width="1920" height="1080"
                                    data-lazyload="{{productItems.cover2}}" data-bgposition="center center"
                                    data-bgfit="contain" data-bgrepeat="no-repeat" class="rev-slidebg" data-no-retina>
                            </li>
                            <li data-index="rs-301" data-transition="scaledownfromleft" data-slotamount="default"
                                data-easein="default" data-easeout="default" data-masterspeed="1500"
                                data-thumb="{{productItems.cover3}}" data-rotate="0" data-saveperformance="off"
                                data-title="Ride my Bike" data-param1="September 4, 2015"
                                data-param2="Why not another Image?" data-description="">
                                <img src="{{productItems.cover3}}" alt="" width="1920" height="1080"
                                    data-lazyload="{{productItems.cover3}}" data-bgposition="center center"
                                    data-bgfit="contain" data-bgrepeat="no-repeat" class="rev-slidebg" data-no-retina>
                            </li>
                            <li data-index="rs-302" data-transition="scaledownfromleft" data-slotamount="default"
                                data-easein="default" data-easeout="default" data-masterspeed="1500"
                                data-thumb="{{productItems.cover4}}" data-rotate="0" data-saveperformance="off"
                                data-title="Ride my Bike" data-param1="September 4, 2015"
                                data-param2="Why not another Image?" data-description="">
                                <img src="{{productItems.cover4}}" alt="" width="1920" height="1080"
                                    data-lazyload="{{productItems.cover4}}" data-bgposition="center center"
                                    data-bgfit="contain" data-bgrepeat="no-repeat" class="rev-slidebg" data-no-retina>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-lg-7">
                <div class="product_details_text">
                    <h3>{{productItems.title}}</h3>
                    {{#starCmt AverageReview}}
                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                    {{/starCmt}}
                    <div class="add_review">
                        <a href="#">{{#SingularOrPlural countCmt}} Reviews{{/SingularOrPlural}}</a>
                        <a href="/products/detail/comment/{{productItems._id}}">Add your review</a>
                    </div>
                    {{#if productItems.discount}}
                    <h5><del>${{productItems.price}}</del> ${{minus productItems.price productItems.discount}}</h5>
                    {{else}}
                    <h5>${{productItems.price}}</h5>
                    {{/if}}
                    <p>{{productItems.description}}</p>


                    <button class="btn-add-to-cart add_cart_btn" value="{{productItems._id}}">Add To Cart</button>

                    <div class="shareing_icon">
                        <h5>share :</h5>
                        <ul>
                            <li><a href="#"><i class="social_facebook"></i></a></li>
                            <li><a href="#"><i class="social_twitter"></i></a></li>
                            <li><a href="#"><i class="social_pinterest"></i></a></li>
                            <li><a href="#"><i class="social_instagram"></i></a></li>
                            <li><a href="#"><i class="social_youtube"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!--================End Product Details Area =================-->

<!--================Product Description Area =================-->
<section class="product_description_area">
    <div class="container">
        <nav class="tab_menu">
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab"
                    aria-controls="nav-home" aria-selected="true">Product Description</a>
                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab"
                    aria-controls="nav-profile" aria-selected="false">Reviews ({{countCmt}})</a>
                <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab"
                    aria-controls="nav-contact" aria-selected="false">Tags</a>
                <a class="nav-item nav-link" id="nav-info-tab" data-toggle="tab" href="#nav-info" role="tab"
                    aria-controls="nav-info" aria-selected="false">additional information</a>
                <a class="nav-item nav-link" id="nav-gur-tab" data-toggle="tab" href="#nav-gur" role="tab"
                    aria-controls="nav-gur" aria-selected="false">gurantees</a>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                <p>{{productItems.description}}</p>
            </div>
            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                {{#each comments}}
                <hr size="0.5" width="98%" color="#CCCCCC">
                <div style="padding: 0% 5%;">
                    <h6>{{NamePerson}}</h6>
                    {{#starCmt Star}}
                    <li><a href="#"><i class="fa fa-star"></i></a></li>
                    {{/starCmt}}
                    <p>{{Comment}}</p>
                </div>
                {{/each}}

            </div>
            <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
                <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est
                    laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque
                    laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto
                    beatae vitae dicta sunt explicabo. Emo enim ipsam voluptatem quia voluptas sit aspernatur aut odit
                    aut fugit, sed quia consequuntur.</p>
            </div>
            <div class="tab-pane fade" id="nav-info" role="tabpanel" aria-labelledby="nav-info-tab">
                <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est
                    laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque
                    laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto
                    beatae vitae dicta sunt explicabo. Emo enim ipsam voluptatem quia voluptas sit aspernatur aut odit
                    aut fugit, sed quia consequuntur.</p>
            </div>
            <div class="tab-pane fade" id="nav-gur" role="tabpanel" aria-labelledby="nav-gur-tab">
                <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est
                    laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque
                    laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto
                    beatae vitae dicta sunt explicabo. Emo enim ipsam voluptatem quia voluptas sit aspernatur aut odit
                    aut fugit, sed quia consequuntur.</p>
            </div>
        </div>
    </div>
</section>
<!--================End Product Details Area =================-->

<!--================End Related Product Area =================-->
<section class="related_product_area">
    <div class="container">
        <div class="related_product_inner">
            <h2 class="single_c_title">Related Product</h2>
            <div class="row isotope_l_p_inner" id="lastest-items">
                {{#each allRelatedProducts}}
                <div class="col-lg-3 col-md-4 col-sm-6 {{filter}}">
                    <div class="l_product_item">
                        <div class="l_p_img">
                            <a href="/products/detail/{{_id}}"><img src="{{cover}}" width="270" height="480"></a>
                        </div>
                        <div class="l_p_text">
                            <ul>
                                <li class="p_icon"><a href="#"><i class="icon_piechart"></i></a></li>
                                <li><button class="btn-add-to-cart add_cart_btn" value="{{_id}}">Add To Cart</button>
                                </li>
                                <li class="p_icon"><a href="#"><i class="icon_heart_alt"></i></a></li>
                            </ul>
                            <h4>{{title}}</h4>
                            {{#if discount}}
                            <h5><del>${{price}}</del> ${{minus price discount}}</h5>
                            {{else}}
                            <h5>${{price}}</h5>
                            {{/if}}
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
    </div>
</section>
<!--================End Related Product Area =================-->

<script type="text/javascript">
    function doComment() {
        const user = req.user;
        console.log(user);
        if (user != undefined) {

            return false;
        }
        else {
            return true;
        }
    }
</script>
<div id='dialog'>

</div>

<script src="/js/jquery-3.2.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.3.0/handlebars.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
<link href="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css" rel="stylesheet"
    type="text/css" />
<script>
    $(document).ready(function () {
        //add to cart dialog
        $('#dialog').dialog({
            autoOpen: false,
            draggable: true,
            dialogClass: "no-close",
            title: "Cart Report",
            show: "blind",
            hide: "explode",
            buttons: [
                {
                    class: "dialog_btn",
                    text: "View Cart",
                    click: function () {
                        window.location.href = '/cart';

                        $(this).dialog("close");
                    }
                },
                {
                    class: "dialog_btn",
                    text: "Continue Shopping",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ],
            open: function (event, ui) {
                $(".ui-widget-overlay").click(function () {
                    $('#dialog').dialog('close');
                });
            }

        });

        ///Add to cart
        $(".btn-add-to-cart").on("click", function (e) {
            let data = {
                id: $(this).val(),
            }

            $('#lastest-items').css('pointerEvents', 'none');
            document.getElementById("lastest-items").style.opacity = "0.5";
            $(this).html('Adding');
            $.post('/cart/add-to-cart', data, (result, status) => {
                if (status == "success") {
                    //set dialog html
                    let name = result.item_name;
                    if (result.fail != 1) { //success
                        $(this).html('Add To Cart');
                        $(this).blur();
                        $('#go_to_cart').html(result.cartCount);
                        let qty = result.item_qty;
                        let total = result.item_total;

                        $('#dialog').html("Product: " + name + "<br>" + "In cart: " + qty + "<br>Total: $" + total);

                    }
                    else { // out of stock
                        $('#dialog').html("This product is out of stock:<br>" + name);
                    }

                    //set position
                    e.pageX += 25;
                    e.pageY += 40;
                    var pos = { my: "left top", at: "left bottom", of: e }

                    $("#dialog").dialog("option", "position", pos)
                        .dialog("open");

                    let dialog_popup = document.getElementById("dialog");
                    if (!elementInViewport(dialog_popup)) {
                        dialog_popup.scrollIntoView();
                    }
                }
                else {

                }
                document.getElementById("lastest-items").style.opacity = "1";
                $('#lastest-items').css('pointerEvents', 'auto');


                return;
            })
        });
        ////////////////
    });
</script>